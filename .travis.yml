dist: trusty
sudo: required
language: node_js
node_js:
- '8'
os:
- linux
env:
  global:
  - DBUS_SESSION_BUS_ADDRESS=/dev/null
  - DISPLAY=:99.0
  - CHROME_BIN=chromium-browser
  - K8S_OPS_REPO_BRANCH=master
  - K8S_OPS_REPO_SLUG=OpenBudget/budgetkey-k8s
  - DOCKER_IMAGE=budgetkey/budgetkey-app-dashboards
  - DEPLOY_YAML_UPDATE_FILE=values.auto-updated.yaml
  - DEPLOY_VALUES_CHART_NAME=app-dashboards
  - DEPLOY_VALUES_IMAGE_PROP=image
  - DEPLOY_COMMIT_MESSAGE="automatic update of budgetkey-app-dashboards"
  - DEPLOY_GIT_EMAIL=budgetkey-deployer@null.void
  - DEPLOY_GIT_USER=budgetkey-deployer
  - secure: r31rCgTTS+yqjJY8wW0VMyQ7ycuJjiSoUiZaa8dJqzBcEq2q9bhH8YpmR/gjjc6s7Wod/6IjuI44DlbRN8bCzxWLJlW3lneTRIoS9n7Cgb/L2NaDD02HAunqdHqqAddROPXldtoDZS475mkidFC7PSLqgLblzXBQgoztuViur5bZLWiOnQEykclYZqiDc1AC0Bl6MNPvEEU7Naj2+yXQnY9FOD4YJc7K1ag58xXCtR2dfxPlmTuO7QMTNWoxL8JVFw3kSgDamgwjZHN2KvUJC9bt+TztZZWKuTY7qLIGg/E5lRzvdwAntfTPANv27LXWylvPxmHSro7qL/VnjiS0iyDemy1xiaYrU/1xtIkorHLhF31rg+EWH5JecD1qY0v/VIXgZEkEz7uERlnvTxyyZSBIZH8DZ2nH/Ut/+ZlV5AKrW8ooDdoOfEJOH7KO7ZmdcYucFeBFeZ4X0QSqYIY7ahSGOK67fNTvgWPSJH1aGm+ndRhNDpjn2YDQmrmx4wnjeNSM+oZQ7iNLgA/ylq9FYtQKHg0JFhQLa28OkVSViXsS+BV+TqHuMY1fwKu53oHnjbIM8h3ppOvRlxakpoVU5JSzh4HyPJv5JSxYLfdD9pMTiupo7eZ1P7Ynd6rDguxJ12Qcd1EelL1wkntBYx0V/jJvRj419s6uR2Co9LuMCdc=
  - secure: ojVkH656N4EwUqmVwBW12JA5g39BDXpB/VgvqvHxFgRaSXCQDptMv40ITp99ygtQH29MmbbY7EZ3Cx1v3mXKXEUIaspP6ZQskwqTsUOW7hnQd5PjDWof6sO23+EQW02cl4E8EEQGIyqhcLaRVI+9X2JJDZQdvroHftjXW+zWe81sTIrGcDTjuLY7/0cTXNB66J3tKlpiUDWkfV9p8z5JC/VffexzfoD+kGvqYmK3juok2cg9xvJdn6a4rLlcSHwAPL0qa0/1fuoEY7oAa7E5Z2qV6AqJFdplDwvzBRAtB2LeMRUzLtDIh5t7VrJFucuPA5lx1xHM5WGiLg4ZrTcMIqs3Cpmwm15FIQpNDT8MfyCzYufrVKmSW+OXVhNQpp1YypgMVzpqhDBj3GU+ZYMDQ3ZkqcuArAgi9fUgq2TAq+Puvjg4UpmApQvXgT4Z+ouFWXTwzHzNwj3RWhwkKaIHQvIca5Rj3I77ajqrfZlZh6hIKr4rzm5XHgD9FBZoTxEdQUGAQ4qzkGkF9Pg1bFO+I2zNYFHZgcDjDIWLntEGx1jivNpmZkCz8aNLEyigznfbUyolmUpwQWSfmbP854GnU9DjmoOVbJMIkP1kepegxV4WmOtLsnYK3tB2HjW/Ho+MIA2sqXoceYDALMA5eVqGzVeLzzmHJfKjHP5y5iaT3ak=
  - secure: XaJWU38psaxhP2l8Ptpx0NH1SB0lb2L5wARr5cSAL8n8B5bgJan3FuPDA3LbGhPzRc3h/QTOjlf0yhoiM3zprMXSke5PYk2iLLBA9AvN5V2JJBkUcpAgazgU+c9Gp6RnhTmGmLcU1PB1n77f5s0WcFzoT2DwaGbB4b3kHycK8XR2RE3oQ/IgYlW6w3naXYqAI6Mm+4hJ5nJdqojhVaFw+MW+89oKy1gCCSub5s0h3+ZRpEtw3JcojsXfrmTkCLpSyDbH850vrXlUpkaQo2YhxEUf3cfZcubO9lhIuRgYRnY/Q0C24G28I6maEOP1n6jmave9U7piYpKwQ66PrZ5R29yAEOcVb9Mn1rGKun5QBFU1U3OuZBhxABmO6ZgK4d26k5e2tDnhOPl/JHlPIw4NBfn/CERASmgy08D69aQ2091w/OJeecQBggd0Z+bKP9LcPGo+VOTTWA7gBT26WRINmXWPoeiocT1+Elo3jXLWeiDOqewUa6EZlEMWPDcg/JbeyoNMf6pSZ0YHM9FbkJCudKVQDeKrVlBGq9HxY2wh3+wO7yVq5ABvpv7B6zk/AnymwD6kQH25O9RgCsrUbkpUzOamMHFvYhTShD1G55qfqBG3dDvettRlWZ88KJE2eJ+2VGURugr6lRoubHjbIO1zG7QTKZ8Y1hqgfJKALESrWw0=
services:
- docker
before_install:
- curl -s https://raw.githubusercontent.com/OpenBudget/budgetkey-k8s/master/apps_travis_script.sh
  > .travis.sh
- bash .travis.sh script
before_script:
- sh -e /etc/init.d/xvfb start
install:
- npm install
- webdriver-manager update
script:
- npm run lint || true
deploy:
  skip_cleanup: true
  provider: script
  script: bash .travis.sh deploy
  on:
    branch: master
